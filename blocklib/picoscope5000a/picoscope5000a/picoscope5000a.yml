module: picoscope5000a
block: picoscope5000a
label: PicoScope 5000a
blocktype: sync_block
includes:
  - gnuradio/digitizers/digitizer_enums.h
  - gnuradio/picoscope5000a/enums.h

parameters:
-   id: serial_number
    label: Serial Number
    dtype: string
-   id: sample_rate
    label: Sample Rate (Hz)
    dtype: rf64
    default: 10000
-   id: buffer_size
    label: Buffer Size
    dtype: size
    default: 8192
-   id: nr_buffers
    label: Number of Buffers
    dtype: size
    default: 100
-   id: driver_buffer_size
    label: Driver Buffer Size
    dtype: size
    default: 100000
-   id: pre_samples
    label: Pre-Sample Count
    dtype: size
    default: 1000
-   id: post_samples
    label: Post-Sample Count
    dtype: size
    default: 9000
-   id: acquisition_mode
    label: Acquisition Mode
    dtype: enums/digitizer_acquisition_mode_t
    is_enum: true
    default: digitizer_acquisition_mode_t::STREAMING
-   id: rapid_block_nr_captures
    label: No. of Captures (Rapid Block Mode)
    dtype: size
    default: 1
-   id: streaming_mode_poll_rate
    label: Polling rate (Streaming Mode)
    dtype: rf64
    default: 0.001
-   id: downsampling_mode
    label: Downsampling Mode
    dtype: enums/digitizer_downsampling_mode_t
    is_enum: true
    default: digitizer_downsampling_mode_t::NONE
-   id: downsampling_factor
    label: Downsampling Factor
    dtype: size
    default: 1
-   id: auto_arm
    label: Auto-Arm
    dtype: bool
    default: 'true'
-   id: trigger_once
    label: Trigger once
    dtype: bool
    default: 'false'
# PS5000A-specific
-   id: resolution
    label: Device Resolution
    dtype: enums/digitizer_resolution_t
    is_enum: true
    default: digitizer_resolution_t::R_8BIT

callbacks:
   - id: hardware_version
     const: true
     return: string
   - id: driver_version
     const: true
     return: string
   - id: actual_sample_rate
     const: true
     return: rf64
   - id: initialize
     return: void
   - id: close
     return: void
# TODO(PORT) maybe makes these parameters (list of structs)
   - id: set_aichan
     return: void
     args:
       - id: id
         dtype: string
       - id: enabled
         dtype: bool
       - id: range
         dtype: rf64
       - id: coupling
         dtype: gr::digitizers::coupling_t
       - id: range_offset
         dtype: rf64
         default: '0' # TODO(PORT) this is currently ignored by the code generation
   - id: set_diport
     return: void
     args:
       - id: id
         dtype: string
       - id: enabled
         dtype: bool
       - id: thresh_voltage
         dtype: rf64
   - id: set_aichan_trigger
     return: void
     args:
       - id: id
         dtype: string
       - id: trigger_direction
         dtype: gr::digitizers::trigger_direction_t
       - id: threshold
         dtype: rf64
ports:
-   domain: stream
    id: out
    direction: out
    type: rf32
    multiplicity: '16'
    optional: true # TODO(PORT) check what's actually needed here, old impl says 16..16, but that doesn't match usage qa_picoscope_5000a.cc

implementations:
-   id: cpu

file_format: 1
