module: digitizers
block: freq_sink
label: Frequency Sink
blocktype: sync_block

includes:
  - gnuradio/digitizers/enums.h
  - gnuradio/digitizers/sink_common.h
  - gnuradio/digitizers/spectra_measurement_t.h

parameters:
-   id: name
    label: Signal Name
    dtype: string
-   id: sample_rate
    label: Sample Rate (Hz)
    dtype: rf32
    gettable: true
-   id: nbins
    label: Number of Bins
    dtype: size
    gettable: true
-   id: nmeasurements
    label: Number of Measurements
    dtype: size
    gettable: true
    default: 1
-   id: nbuffers
    label: Number of Buffers
    dtype: size
    default: 1
-   id: mode
    label: Sink Mode
    dtype: enums/freq_sink_mode_t
    is_enum: true
    gettable: true

callbacks:
    - id: get_metadata # TODO(PORT) do we really need this getter, can't we just make name and unit gettable?
      return: signal_metadata_t
      const: true
    - id: get_measurements
      return: spectra_measurement_t
      args:
      - id: items_to_read
        dtype: size
    - id: set_callback
      return: void
      args:
      - id: callback
        dtype: std::function<void(int64_t, std::string, void*)>
      - id: user_data
        dtype: void*

ports:
-   domain: stream
    id: magnitude
    direction: input
    type: rf32
    shape: parameters/nbins
-   domain: stream
    id: phase
    direction: input
    type: rf32
    shape: parameters/nbins
-   domain: stream
    id: freqs
    direction: input
    type: rf32
    shape: parameters/nbins

implementations:
-   id: cpu

file_format: 1

doc:
  brief: Spectra measurement metadata.
  detail: |-
        Note, trigger_timestamp is the the same timestamp as provided to the time-realignment block
        (via the add_timing_event method), else it contains the local timestamp of the first
        post-trigger sample.

        Member-variable timestamp contains timestamp of the first pre-trigger sample, or if there is
        none the timestamp of the first sample.
