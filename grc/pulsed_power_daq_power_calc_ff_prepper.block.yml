id: pulsed_power_daq_power_calc_ff_prepper
label: power_calc_ff_prepper
category: '[pulsed_power_daq]'

templates:
    imports: import pulsed_power_daq
    make: "pulsed_power_daq.power_calc_ff_prepper(\n    bp_decimation=${ bp_decimation }, samp_rate=${ samp_rate })"

    callbacks:
    - set_bp_decimation(${ bp_decimation })
    - set_samp_rate(${ samp_rate })

#  Make one 'parameters' list entry for every parameter you want settable from the GUI.
#     Keys include:
#     * id (makes the value accessible as keyname, e.g. in the make entry)
#     * label (label shown in the GUI)
#     * dtype (e.g. int, float, complex, byte, short, xxx_vector, ...)
#     * default
parameters:
- id: bp_decimation
  label: bandpass decimation
  dtype: int
  default: 20
  hide: none
- id: samp_rate
  label: Input Sample Rate
  dtype: int
  default: 2000000
  hide: none
#- id: ...
#  label: ...
#  dtype: ...

#  Make one 'inputs' list entry per input and one 'outputs' list entry per output.
#  Keys include:
#      * label (an identifier for the GUI)
#      * domain (optional - stream or message. Default is stream)
#      * dtype (e.g. int, float, complex, byte, short, xxx_vector, ...)
#      * vlen (optional - data stream vector length. Default is 1)
#      * optional (optional - set to 1 for optional inputs. Default is 0)
inputs:
- label: Voltage
  dtype: float

- label: Current
  dtype: float
#  domain: ...
#  vlen: ...
#  optional: ...

outputs:
- label: Delta Phase PHI
  dtype: float
- label: Band Pass Current
  dtype: float
- label: Band Pass Voltage
  dtype: float
- label: Raw Current
  dtype: float
- label: Raw Voltage
  dtype: float
#  domain: ...
#  vlen: ...
#  optional: ...

#  'file_format' specifies the version of the GRC yml format used in the file
#  and should usually not be changed.

documentation: |-
    This block prepares data for power calc block. Use in conjunction with power calc advised. Adapted to work with picoscope 4000a.
    It will multiply input current signal by 2.5 and input voltage by 100, since these are the expected ranges from picoscope.
    parameters:
      bandpass decimation: factor by which sample rate will be cut for output sample rate. Output sample rate will be input_sample_rate/decimation

file_format: 1
